function [Ranked_Fitness,RankedPopulation,Allfitness,Pop]=AllFitnessCalandSort(Population)
global SupplySectionNum;%??????
global TrainNum;%?��???
global StationNum;%?????
global Num_StopPlan;%??????????

global f_travel;
global f_service;
global f_safety;
%???????��???????????????
global MaxTotalTravelTimeDown;
global MinTotalTravelTimeDown;
global MaxTotalTravelTimeUp;
global MinTotalTravelTimeUp;

global ServiceTimeConstrant;%??��???????
global OperationScheme;%???��??????��??????????��??????��????????1??????0??????
global OptimizationData;%????????????
global MaxTotalSectionTimeEachPlanDown%?????????????????????????????????????????????
global MaxTotalSectionTimeEachPlanUp%?????????????????????????????????????????????
global MaxTotalDwellTimeEachPlan%????????????????????????
global TotalStopTimes;%???��?????????
global TotalSections;%???��?????????'
global P_auxi;
global StartStation;
global EndStation;

SupplySectionNum2=SupplySectionNum;
TrainNum2=TrainNum;
StationNum2=StationNum;
Num_StopPlan2=Num_StopPlan;
f_travel2=f_travel;
f_service2=f_service;
f_safety2=f_safety;
MaxTotalTravelTimeDown2=MaxTotalTravelTimeDown;
MinTotalTravelTimeDown2=MinTotalTravelTimeDown;
MaxTotalTravelTimeUp2=MaxTotalTravelTimeUp;
MinTotalTravelTimeUp2=MinTotalTravelTimeUp;
ServiceTimeConstrant2=ServiceTimeConstrant;
OperationScheme2=OperationScheme;
OptimizationData2=OptimizationData;
MaxTotalSectionTimeEachPlanDown2=MaxTotalSectionTimeEachPlanDown;
MaxTotalSectionTimeEachPlanUp2=MaxTotalSectionTimeEachPlanUp;
MaxTotalDwellTimeEachPlan2=MaxTotalDwellTimeEachPlan;
TotalStopTimes2=TotalStopTimes;
TotalSections2=TotalSections;
P_auxi2=P_auxi;
StartStation2=StartStation;
EndStation2=EndStation;

% if(isempty(gcp('nocreate')))   % ?��?????????????��???
%   parpool(7);  % ???????��???
% end
Allfitness=zeros(1,size(Population,3));
for i=1:1:size(Population,3)  % 使用size(Population,3)获取第三维大小
    [Allfitness(1,i)]=FitnessCalc_Optimized(Population(:,:,i),SupplySectionNum2,TrainNum2,StationNum2,Num_StopPlan2,f_travel2,f_service2,f_safety2,MaxTotalTravelTimeDown2,MinTotalTravelTimeDown2,MaxTotalTravelTimeUp2,MinTotalTravelTimeUp2,ServiceTimeConstrant2,OperationScheme2,OptimizationData2,MaxTotalSectionTimeEachPlanDown2,MaxTotalSectionTimeEachPlanUp2,MaxTotalDwellTimeEachPlan2,TotalStopTimes2,TotalSections2,P_auxi2,StartStation2,EndStation2);
end
[Ranked_Fitness,ind]=sort(Allfitness);
RankedPopulation=Population(:,:,ind);
Pop=Population;

end

